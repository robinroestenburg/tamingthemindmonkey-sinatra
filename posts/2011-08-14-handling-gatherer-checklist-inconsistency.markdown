---
layout: post
title: Handling Gatherer checklist inconsistency
tags: mtg mychain
---
<p>Yesterday I ran into an inconsistency in the number that the Gatherer site showed above a checklist and the actual number of cards that are present on the checklist. As an example I mentioned the checklist for <a title="Mirrodin Besieged checklist" href="http://gatherer.wizards.com/Pages/Search/Default.aspx?sort=cn+&amp;output=checklist&amp;set=|[%22Mirrodin%20Besieged%22]" target="_blank">Mirrodin Besieged</a>: Gatherer says it has 150 cards while the table below counts 155 cards (which is the correct number).</p>
<p><img class="posterous_plugin_object posterous_plugin_object_image" src="http://getfile3.posterous.com/getfile/files.posterous.com/temp-2011-08-14/hltEGumzaDJfFrmygqoundyczvJEFInsxpoDnqlzHvHbcuBcnEaCItalpbcm/Screen_Shot_2011-08-14_at_12.36.50_PM.png.thumb100.png?content_part=CvvBweihgoJrJbDhclsw" alt="" width="100" height="100" />The problem is caused by a number of cards that have the same name. This set has 2 variations for each basic land card, so two <em>Plains</em>, two <em>Island</em>, two <em>Swamp</em>, two <em>Mountain</em> and two <em>Forest</em> cards:</p>
<p><img class="posterous_plugin_object posterous_plugin_object_image" src="http://getfile2.posterous.com/getfile/files.posterous.com/temp-2011-08-14/hxFpmpsAcwqfttCDkcuHsfudxdkolDexmaivbhcesypyBnGfspbtolvdfDxD/Screen_Shot_2011-08-14_at_12.37.04_PM.png.thumb100.png?content_part=GdpefadpdCgaqbDbmrqA" alt="" width="100" height="100" /></p>
<p>So, the Gatherer site probably counts the names as the number of unique cards present in the set instead of the actual number.</p>
<h2>Basic lands</h2>
<p>For everyone not familiar with the <em>Magic: The Gathering</em> game and basic lands:</p>
<blockquote>
<p>The two basic card types in <em>Magic</em> are "spells" and "lands". Lands provide mana, or magical energy, which is used as magical fuel when the player attempts to cast spells. Most spells come in one of five colors. To play a spell of a given color, at least one mana of that color is required. This mana is normally generated by a basic land: plains for white, island for blue, swamp for black, mountain for red, and forest for green. - <a href="http://en.wikipedia.org/wiki/Magic:_The_Gathering">Wikipedia</a></p>
</blockquote>
<h2>Handling the incosistency</h2>
<p>The <strong>CheckList</strong>.<strong>get_card_identifiers</strong> (see <a href="http://www.tamingthemindmonkey.com/65201891" target="_blank">Testing the Gatherer API using VCR</a>) returns the identifier for every row on the checklist page. This method now returns duplicate identifiers for a set containing cards with the same name (as in our running example <em>Mirrodin Besieged</em>).</p>
<p>For example, the two <em>Plains</em> cards in above screenshot (nr. 146 and 147) point to the same card details page with identifier = 220366. On this page the two variations of the <em>Plains</em> card are present:</p>
<p><img class="posterous_plugin_object posterous_plugin_object_gallery" src="http://getfile2.posterous.com/getfile/files.posterous.com/temp-2011-08-14/lEEGlabclkaxjigmqjglhgsqzFulqnajlsoAEbpugDaBBcxDHhyGchkgDyxG/Screen_Shot_2011-08-14_at_1.03.40_PM.png.thumb100.png?content_part=GwHfAqawpaJicbozAoCf" alt="" width="100" height="100" /></p>
<p>This means the <strong>get_card_identifiers</strong> method returns duplicate identifiers and does not return all of the cards present in the set. There are a couple of things I could do now:</p>
<ul>
</ul>
<ol>
<li>Change the <strong>get_card_identifiers</strong> method in such a way that it retrieves the identifiers for the duplicate cards. After a bit of digging around in the source of the page showed me that there I can  actually the identifier for each card number from the details page. Card #146 has identifier  220366 and card #147 has identifier 214057 in our example. </li>
<li>Change the name of the method into <strong>get_card_names</strong> and have it return the (unique) names present in the checklist. There is no easy way to load the card details page with only the name of the card. Loading the details page with a name shows the card from the last released set (?) - you can get to the set you are looking for by selecting the symbol from the <em>Other sets</em>-part of the table with details: <img class="posterous_plugin_object posterous_plugin_object_image" src="http://getfile3.posterous.com/getfile/files.posterous.com/temp-2011-08-14/ubsdvDtDCtIdpfdhulAjidcHmyeEkEDnafhvGGqwuktlAAfgAvfrtnAGgrAx/Screen_Shot_2011-08-14_at_1.23.44_PM.png.thumb100.png?content_part=EffwenBfBfIxAsppsuui" alt="" width="100" height="100" />As you can see, the Plains card is used in a lot of sets ;)</li>
<li>Change the name of the method into <strong>get_cards</strong> and have it return actual <em>Card</em>-objects containing all information on the details page. The <strong>CheckList</strong><em>-</em>class would have to use a different class to get all the information it needs. <em><br /></em></li>
</ol>
<p>The first option makes the scraping of the checklist page much more complex. The second option delegates the complexity, but in this case to two classes:<br />1. the caller of <strong>get_card_names</strong>; it has to retrieve the cards for each name, and add those cards together into a list of some sort, and<br />2. the class that retrieve the card details for a card name; it has to know which set the card belongs to, pick this set from the <em>Other sets</em> part, load the new details page, etc.<br />The third option also delegates the complexity of getting the correct card for a duplicate row, but only to one other class. The calling class gets the Card-objects it has requested and does not have to do anything else.</p>
<p>I'm going with the third option for now.</p>
<blockquote>
<div>Day #6</div>
</blockquote>
